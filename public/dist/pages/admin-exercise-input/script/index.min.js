var adjustSize,chapterId,constant,exerciseEditor,gradeSubjectId,input_opener,parameter,sample_formula_row;parameter=[],constant=[],gradeSubjectId=null,chapterId=null,exerciseEditor=null,$("#exercise-input-wizard").steps({headerTag:"h3",bodyTag:"section",stepsOrientation:"vertical",labels:{finish:"Kết thúc",next:"Tiếp theo",previous:"Trước"},onStepChanging:function(e,t,n){var i,a,r,o,u,p;if(0===t){if(gradeSubjectId=Number($("#input-gradeSubjectId option:selected").val()),chapterId=Number($("#input-chapterId option:selected").val()),-1===gradeSubjectId||-1===chapterId)return bootbox.alert("Chưa chọn thông tin về môn/ khối hoặc chương!"),!1}else if(1===t)for(a=$(" .formula-contaniner").find(".input-formula-row"),constant=[],parameter=[],o=r=0,u=a.length;r<u;o=++r)if(a[o],p=a.eq(o).find(".input-formula-bare-tex").eq(0).text(),i=a.eq(o).find(".input-formula-anglemode").eq(0).text(),a.eq(o).find(".input-param").eq(0).prop("checked")){if(""===p)return bootbox.alert("Tham số đầu vào không được phép rỗng!"),!1;parameter.push({tex:p,anglemode:i})}else""!==p&&constant.push({tex:p,anglemode:i});return!0},onFinished:function(e,t){var n;return n=exerciseEditor.getData(),window.location.href.indexOf("sua-de-bai")>=0?$.post("/luu-sua-de",{exerciseId:$("#exerciseId").val(),chapterId:chapterId,content:n,constant:JSON.stringify(constant),parameter:JSON.stringify(parameter),level:$("#input-level option:selected").val()},function(e){return window.location.href="/thong-tin-bai-tap"}):$.post("/luu-bai-moi",{chapterId:chapterId,content:n,constant:JSON.stringify(constant),parameter:JSON.stringify(parameter),level:$("#input-level option:selected").val()},function(e){return window.location.href="/them-bai-tap-moi"})}}),$(".add-param").click(function(){return bootbox.prompt({title:"Chọn 1 tham số đầu vào để hiển thị",inputType:"checkbox",inputOptions:parameter.map(function(e){return{text:"\\("+e.tex+"\\)",value:""+e.tex}}),closeButton:!1,callback:function(e){if(e.length>0)return e[0],exerciseEditor.insertText("\\("+e[0]+"\\)"),MathJax.Hub.Queue(["Typeset",MathJax.Hub])}}),MathJax.Hub.Queue(["Typeset",MathJax.Hub])}),$("select").select2({language:"vi"}),$("#input-gradeSubjectId").on("change",function(e){var t,n;return n=Number($(this).find("option:selected").val()),t=new Option("Chọn chương học tương ứng của bài tập","1",!0,!0),-1===n?($("#input-chapterId").empty().trigger("change"),$("#input-chapterId").append(t).trigger("change")):$.post("/lay-chuong-theo-mon-khoi",{gradeSubjectId:n},function(e){var n,i,a,r,o;for($("#input-chapterId").empty().trigger("change"),$("#input-chapterId").append(t).trigger("change"),o=[],i=0,a=e.length;i<a;i++)n=e[i],r=new Option(n.ChapterName,n.ChapterId,!1,!1),o.push($("#input-chapterId").append(r).trigger("change"));return o})}),$(".input-param").iCheck({checkboxClass:"icheckbox_flat-blue"}),input_opener=null,sample_formula_row=null,$(document).ready(function(){return CKEDITOR.replace("exercise-input",{allowedContent:!0,entities:!1}),exerciseEditor=CKEDITOR.instances["exercise-input"]}),$(".add-new-formula").click(function(){return $(".formula-contaniner").append('<div class="row input-formula-row"> <div class="col-md-9 input-formula-box"> <div class="input-formula"> <div class="input-formula-tex">\\(\\)</div> <div class="input-formula-bare-tex hidden"></div> <div class="input-formula-anglemode hidden"></div> </div> </div> <div class="col-md-3 input-param-box"> <label> <input class="input-param" type="checkbox"><span style="padding-left: 3px;">Tham số đầu vào</span> </label> </div> </div>'),MathJax.Hub.Queue(["Typeset",MathJax.Hub]),$(".input-param").iCheck({checkboxClass:"icheckbox_flat-blue"}),$(".input-formula").click(function(){return input_opener=$(this),window.open("/may-tinh-kogida?editor=true&solver=false","popupWindow","width=600, height=400, scrollbars=yes")})}),$(".input-formula").click(function(){return input_opener=$(this),window.open("/may-tinh-kogida?editor=true&solver=false","popupWindow","width=600, height=400, scrollbars=yes")}),$(".open-editor").click(function(){var e;return"solution"===(e=$(this).data("editor"))?window.open("/may-tinh-kogida?editor=true&solver=false&ck=solution-input","popupWindow","width=600, height=400, scrollbars=yes"):"exercise"===e?window.open("/may-tinh-kogida?editor=true&solver=false&ck=exercise-input","popupWindow","width=600, height=400, scrollbars=yes"):void 0}),adjustSize=function(){var e,t;return t=input_opener.find("div").eq(0),e=t.height(),input_opener.css("cssText","height: "+(e+20)+"px !important;")},window.setMathFormula=function(e,t){return input_opener.find("div").eq(0).text("\\("+e+"\\)"),input_opener.find("div").eq(1).text(e),input_opener.find("div").eq(2).text(t),MathJax.Hub.Queue(["Typeset",MathJax.Hub]),adjustSize()},window.insertMathFormula=function(e,t){return CKEDITOR.instances[e].insertText("\\("+t+"\\)")};