var exam,focusElement,labelContainer;labelContainer=null,exam=null,focusElement={element:null,value:null},$(document).ready(function(){var n,e,t,i,u;if($("input[name=DeadlineDate]").inputmask(),labelContainer=$(".label-container:eq(0)").clone(),$("form#form_step1").submit(function(n){var e,t,i,u,r,o,a,l,s,c,m,f,d,h,g,b;for(n.preventDefault(),f=m=0,b=(l=(r=(c=$(this).serializeArray()).filter(function(n){return"QuestionLabel"===n.name}).map(function(n){return n.value})).map(function(n){return n.trim()}).sort()).length-1;m<b;f=m+=1)if(l[f]===l[f+1])return swal("Thông báo","Tồn tại nhãn trùng nhau","error"),!1;if(o=c.filter(function(n){return"QuestionNumberWithLabel"===n.name}).map(function(n){return n.value}),a=r.map(function(n,e){return{label:n,number:o[e]}}).filter(function(n){return""!==n.label.trim()}),s=c.find(function(n){return"Time"===n.name}).value,i=c.find(function(n){return"QuestionNumber"===n.name}).value,u=c.find(function(n){return"QuestionNumberInput"===n.name}).value,isNaN(s)||Number(s)<=0)return swal("Thông báo","Thời gian nhập vào không đúng. Vui lòng nhập lại!","error"),!1;if(isNaN(i)||Number(i)<0||Math.floor(i)!==Math.ceil(i))return swal("Thông báo","Số lượng câu hỏi để thi không đúng. Vui lòng nhập lại!","error"),!1;if(isNaN(u)||Number(u)<0||Math.floor(u)!==Math.ceil(u))return swal("Thông báo","Số lượng câu hỏi nhập vào không đúng. Vui lòng nhập lại!","error"),!1;if(Number(u)<Number(i))return swal("Thông báo","Số lượng câu hỏi nhập vào nhỏ hơn số lượng câu hỏi để thi. Vui lòng nhập lại!","error"),!1;if(c.findIndex(function(n){return"UseDeadline"===n.name})>=0&&(e=c.find(function(n){return"Deadline"===n.name}).value,!moment(e,"DD/MM/YYYY HH:mm").isValid()))return swal("Thông báo","Ngày nhập không đúng. Vui lòng nhập lại!","error"),!1;if(a.length>0){for(i=Number(c.find(function(n){return"QuestionNumber"===n.name}).value),t=0,d=0,h=a.length;d<h;d++)g=a[d],t+=Number(g.number);if(i!==t)return swal("Thông báo","Số lượng câu hỏi không bằng với tổng số lượng trong cơ cấu nhãn. Vui lòng nhập lại!","error"),!1;$(this).unbind().submit()}else window.location.href="/admin/luu-thi-thu/buoc-1?ExamName="+c.find(function(n){return"ExamName"===n.name}).value+"&Time="+c.find(function(n){return"Time"===n.name}).value+"&GradeSubjectId="+c.find(function(n){return"GradeSubjectId"===n.name}).value+"&QuestionNumber="+c.find(function(n){return"QuestionNumber"===n.name}).value+"&QuestionNumberInput="+c.find(function(n){return"QuestionNumberInput"===n.name}).value+"&UseDeadline="+(c.findIndex(function(n){return"UseDeadline"===n.name})>=0?"yes":"no")+"&Deadline="+c.find(function(n){return"Deadline"===n.name}).value+"&UseSecret="+(c.findIndex(function(n){return"UseSecret"===n.name})>=0?"yes":"no")+"&Secret="+c.find(function(n){return"Secret"===n.name}).value;return!1}),window.location.href.indexOf("buoc-2")>=0){for(exam=JSON.parse($("#examInfo").val()),n=JSON.parse(exam.Structure).QuestionNumberInput,e=JSON.parse(exam.Structure).QuestionWithLabelAndNumberList,i=t=0,u=n;t<u;i=t+=1)CKEDITOR.replace("content_"+i,{allowedContent:!0,entities:!1,extraAllowedContent:"span"});return CKEDITOR.on("instanceReady",function(n){return n.editor.on("focus",function(){return focusElement.element="textarea",focusElement.value=""+n.editor.name}),window.setMathFormula=function(n){var e;return"input"===focusElement.element?(e=focusElement.value.val(),focusElement.value.val(e+"\\( \\displaystyle "+n+" \\)"),focusElement.value.focus()):CKEDITOR.instances[""+focusElement.value].insertText("\\(\\displaystyle "+n+"\\)")}}),$("form#form_step2").submit(function(t){var u,r,o,a,l,s;for(t.preventDefault(),o=$(this).serializeArray(),r=[],i=a=0,l=n;a<l;i=a+=1)s=Number(o.find(function(n){return n.name==="issolution_"+i}).value),u=e.length>1?{Content:o.find(function(n){return n.name==="content_"+i}).value,Label:o.find(function(n){return n.name==="label_"+i}).value,AllowRandom:o.findIndex(function(n){return n.name==="allowrandom_"+i})>=0,SolutionList:o.filter(function(n){return n.name==="solutiontext_"+i}).map(function(n){return n.value}).map(function(n,e){return new Object({text:n,solution:s===Number(e),id:e})}),MaxSolutionInRow:o.find(function(n){return n.name==="maxsolutioninrow_"+i}).value,ImageList:o.filter(function(n){return n.name==="imglink_"+i}).map(function(n){return n.value}).filter(function(n){return""!==n.trim()}),MaxImageInRow:o.find(function(n){return n.name==="maximginrow_"+i}).value}:{Content:o.find(function(n){return n.name==="content_"+i}).value,AllowRandom:o.findIndex(function(n){return n.name==="allowrandom_"+i})>=0,SolutionList:o.filter(function(n){return n.name==="solutiontext_"+i}).map(function(n){return n.value}).map(function(n,e){return new Object({text:n,solution:s===Number(e),id:e})}),MaxSolutionInRow:o.find(function(n){return n.name==="maxsolutioninrow_"+i}).value,ImageList:o.filter(function(n){return n.name==="imglink_"+i}).map(function(n){return n.value}).filter(function(n){return""!==n.trim()}),MaxImageInRow:o.find(function(n){return n.name==="maximginrow_"+i}).value},r.push(u);return $(this).unbind().submit(),!1})}}),$("#open_editor").click(function(){return window.open("/may-tinh-kogida?editor=true&solver=false","popupWindow","width=600, height=400, scrollbars=yes")}),$("#input-gradesubjectid").select2({language:"vi"}),$("select").select2({language:"vi"}),$("#add-label").click(function(){return $("#form_step1 .box-body").append(labelContainer),labelContainer=$(".label-container:eq(0)").clone(),$(".remove-label").click(function(){return $(this).closest(".label-container").remove()})}),$(".remove-label").click(function(){return $(this).closest(".label-container").remove()}),$("#previous").click(function(){var n,e;if(n=Number($("#questionList").find("option:selected").val()),(e=n-1)>=0)return $(".question-container.show").toggleClass("hidden"),$(".question-container.show").toggleClass("show"),$(".question-container[data-index="+e+"]").toggleClass("hidden"),$(".question-container[data-index="+e+"]").toggleClass("show"),$("#questionList").val(e).trigger("change")}),$("#next").click(function(){var n,e,t;if(e=Number($("#questionList").find("option:selected").val()),t=e+1,n=JSON.parse(exam.Structure).QuestionNumberInput,t<n)return $(".question-container.show").toggleClass("hidden"),$(".question-container.show").toggleClass("show"),$(".question-container[data-index="+t+"]").toggleClass("hidden"),$(".question-container[data-index="+t+"]").toggleClass("show"),$("#questionList").val(t).trigger("change")}),$("#questionList").on("change",function(n){var e;return e=Number($(this).find("option:selected").val()),$(".question-container.show").toggleClass("hidden"),$(".question-container.show").toggleClass("show"),$(".question-container[data-index="+e+"]").toggleClass("hidden"),$(".question-container[data-index="+e+"]").toggleClass("show")}),$("textarea").focus(function(n){return focusElement.element="textarea",focusElement.value=$(this).attr("name")}),$("input").focus(function(n){return focusElement.element="input",focusElement.value=$(this)});